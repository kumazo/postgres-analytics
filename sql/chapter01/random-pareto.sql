--
-- パレート分布乱数（Pareto distribution）
--


-- 逆関数法によるパレート分布
with
params as (
  select
    1::double precision     as xm,
    1.16::double precision  as α
)
select xm / power((1 - random()), 1/α) from params
;
/*
    ?column?     
-----------------
 2.0036382687914
(1 row)
*/

--
-- パレート分布乱数
-- xm 下限値
-- α  分布パラメータ
--
create or replace function random_pareto(xm double precision, α double precision)
returns double precision
as $$
  select xm / power((1 - random()), 1/α);
$$ language sql;

-- 試行
select random_pareto(xm := 1, α := 1.16) as par
from generate_series(1, 1000);


-- 分布
with
params as (
  select 
    1::double precision as xm,
    1.16::double precision as α
),
pareto as (
  select random_pareto(xm, α) as par
  from params, generate_series(1, 1000)
)
select 
 trunc(par * 10) / 10 as bin,
 count(par) as cnt,
 repeat('*', count(par)::int) as bar
from pareto
group by trunc(par * 10)
order by bin
;
/*
  bin  | cnt |                                                             bar                                                              
-------+-----+------------------------------------------------------------------------------------------------------------------------------
     1 | 124 | ****************************************************************************************************************************
   1.1 |  89 | *****************************************************************************************
   1.2 |  64 | ****************************************************************
   1.3 |  59 | ***********************************************************
   1.4 |  55 | *******************************************************
   1.5 |  37 | *************************************
   1.6 |  35 | ***********************************
   1.7 |  33 | *********************************
   1.8 |  24 | ************************
   1.9 |  35 | ***********************************
     2 |  26 | **************************
   2.1 |  22 | **********************
   2.2 |  20 | ********************
   2.3 |  27 | ***************************
   2.4 |  11 | ***********
   2.5 |  13 | *************
   2.6 |  23 | ***********************
   2.7 |  12 | ************
   2.8 |  14 | **************
   2.9 |  12 | ************
     3 |  11 | ***********
   3.1 |  11 | ***********
   3.2 |   6 | ******
   3.3 |   6 | ******
   3.4 |  12 | ************
   3.5 |  10 | **********
   3.6 |   8 | ********
   3.7 |   4 | ****
   3.9 |   7 | *******
     4 |   5 | *****
   4.1 |   3 | ***
   4.2 |   1 | *
   4.3 |   3 | ***
   4.4 |   6 | ******
   4.5 |   5 | *****
   4.6 |   5 | *****
   4.7 |   6 | ******
   4.8 |   4 | ****
   4.9 |   1 | *
     5 |   3 | ***
   5.1 |   1 | *
   5.2 |   2 | **
   5.3 |   1 | *
   5.4 |   3 | ***
   5.5 |   7 | *******
   5.6 |   1 | *
   5.7 |   2 | **
   5.8 |   1 | *
   5.9 |   4 | ****
     6 |   2 | **
   6.1 |   2 | **
   6.2 |   3 | ***
   6.3 |   1 | *
   6.4 |   2 | **
   6.5 |   2 | **
   6.6 |   3 | ***
   6.8 |   2 | **
     7 |   1 | *
   7.1 |   2 | **
   7.2 |   1 | *
   7.3 |   4 | ****
   7.4 |   4 | ****
   7.5 |   3 | ***
   7.7 |   3 | ***
   7.8 |   3 | ***
   7.9 |   1 | *
     8 |   1 | *
   8.1 |   4 | ****
   8.2 |   2 | **
   8.3 |   1 | *
   8.4 |   3 | ***
   8.5 |   1 | *
   8.8 |   1 | *
   8.9 |   1 | *
   9.1 |   1 | *
   9.3 |   1 | *
   9.5 |   1 | *
   9.6 |   1 | *
   9.9 |   1 | *
  10.1 |   1 | *
  10.2 |   1 | *
  10.3 |   2 | **
  10.5 |   1 | *
  10.7 |   5 | *****
  10.8 |   1 | *
  10.9 |   1 | *
    11 |   1 | *
  11.2 |   1 | *
  11.4 |   1 | *
  11.6 |   2 | **
  11.7 |   1 | *
  12.1 |   1 | *
  12.2 |   1 | *
  12.3 |   2 | **
  12.4 |   1 | *
  12.9 |   1 | *
    13 |   1 | *
  13.8 |   1 | *
    14 |   1 | *
  15.1 |   1 | *
  15.4 |   1 | *
    16 |   2 | **
  16.6 |   1 | *
  17.2 |   2 | **
  17.5 |   1 | *
  17.6 |   1 | *
  18.2 |   1 | *
  18.3 |   1 | *
  18.6 |   1 | *
  19.2 |   1 | *
  19.9 |   1 | *
  20.8 |   1 | *
  21.7 |   1 | *
    22 |   1 | *
  22.2 |   1 | *
  23.7 |   1 | *
  24.4 |   2 | **
  25.5 |   1 | *
  25.8 |   1 | *
  28.5 |   1 | *
    29 |   1 | *
  30.1 |   1 | *
  30.6 |   1 | *
  31.6 |   1 | *
  32.5 |   1 | *
  33.3 |   1 | *
  33.6 |   1 | *
  35.5 |   1 | *
  38.3 |   1 | *
  39.6 |   1 | *
    48 |   1 | *
  48.1 |   1 | *
  49.3 |   1 | *
  50.9 |   1 | *
  58.3 |   1 | *
 113.1 |   1 | *
 261.2 |   1 | *
(137 rows)
*/


-- 後始末
drop function if exists random_pareto;

